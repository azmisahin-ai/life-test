<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evrimsel Biyoloji Simülasyonu</title>
</head>

<body>


    <label for="genomeLength">Genom Uzunluğu:</label>
    <input type="number" id="genomeLength" value="2">

    <label for="distributionType">Genom Dağılım Türü:</label>
    <select id="distributionType">
        <option value="uniform">Eşit Olasılıklı</option>
        <option value="normal">Normal Dağılım</option>
        <option value="artan">Artan dağılım</option>
        <option value="fibonacci">Fibonacci algoritması</option>
    </select>
    <label for="fitnessFunction">Fitness Fonksiyonu:</label>
    <select id="fitnessFunction">
        <option value="absoluteDifference">Genler Arasındaki Mutlak Fark</option>
        <option value="random">Rastgele</option>
        <!-- İleriye dönük başka fitness fonksiyonları da ekleyebilirsiniz -->
    </select>
    <label for="initialPopulationSize">Başlangıç Popülasyon Boyutu:</label>
    <input type="number" id="initialPopulationSize" value="10">

    <label for="targetGeneration">Hedef Generasyon Sayısı:</label>
    <input type="number" id="targetGeneration" value="20">

    <button onclick="startSimulation()">Simülasyonu Başlat</button>

    <canvas id="fitnessChart" width="600" height="400"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

        // Simülasyon sonuçları
        const generations = [];
        const fitnessValues = [];
        function randomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
        // Grafiği oluştur
        const ctx = document.getElementById('fitnessChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: generations,
                datasets: [{
                    label: 'Fitness Değeri',
                    data: fitnessValues,
                    borderColor: randomColor(), // Rastgele renk
                    borderWidth: 1,
                    fill: false,
                }]
            },
            options: {
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom'
                    },
                    y: {
                        min: 0,
                        max: 1,
                        ticks: {
                            stepSize: 0.1
                        }
                    }
                }
            }
        });

        function updateChart(generation, fitnessValue) {
            console.log(generation, fitnessValue)
            myChart.data.labels.push(generation);
            myChart.data.datasets[0].data.push(fitnessValue);
            myChart.data.datasets[0].borderColor = randomColor(); // Rastgele renk
            myChart.update();
        }
    </script>

    <h1>Evrimsel Biyoloji Simülasyonu</h1>
    <p>
        Genom Uzunluğu (Genome Length): Bu değer, her bir bireyin genomunun kaç elemanlı olacağını belirler. Örneğin,
        genom uzunluğu 2 olarak ayarlandığında, her bireyin geni iki elemanlı bir dizi olacaktır. Bu genler rastgele
        sayılardan oluşur.
    </p>
    <p>
        Başlangıç Popülasyon Boyutu (Initial Population Size): Bu değer, evrimin başladığı ilk nesildeki bireylerin
        sayısını belirler. Örneğin, başlangıç populasyon boyutu 10 olarak ayarlandığında, evrim ilk nesilde 10 birey ile
        başlar.
    </p>
    <p>
        Hedef Generasyon Sayısı (Target Generation): Bu değer, simülasyonun kaç generasyon boyunca devam edeceğini
        belirler. Örneğin, hedef generasyon sayısı 20 olarak ayarlandığında, simülasyon 20 generasyon boyunca
        çalışacaktır.
    </p>
    <p>
        Simülasyonu Başlat (Start Simulation): Bu düğmeye basıldığında, belirtilen genom uzunluğu ve başlangıç
        populasyon boyutu ile birlikte genetik algoritma temelli evrimsel bir simülasyon başlar.
    </p>
    <p>
        Simülasyonun sonuçları tabloda listelenir:
    </p>
    <p>
        Generasyon (Generation): Simülasyonun kaçıncı generasyonunda olduğumuzu gösterir.
    </p>
    <p>
        En İyi Bireyin Genomu (Best Individual's Genome): Bu, her generasyonda en iyi fitness değerine sahip bireyin
        genetik yapısını temsil eden bir dizi.
    </p>
    <p>
        En İyi Bireyin Fitness Değeri (Best Individual's Fitness): Bu, her generasyonda en iyi fitness değerine sahip
        bireyin ne kadar iyi performans gösterdiğini gösteren bir sayı. Fitness değeri ne kadar yüksekse, birey o kadar
        iyi adaptasyon sağlamış demektir.
    </p>
    <p>
        Bu parametreleri değiştirdiğinizde, simülasyonun sonuçları ve evrimsel süreçteki değişiklikler de farklılık
        gösterecektir.
    </p>

    <table border="1">
        <thead>
            <tr>
                <th>Generasyon</th>
                <th>En İyi Bireyin Genomu</th>
                <th>En İyi Bireyin Fitness Değeri</th>
            </tr>
        </thead>
        <tbody id="simulationResult"></tbody>


    </table>

    <script>
        // Genetik algoritma ile evrimsel biyoloji simülasyonu
        class Individual {
            constructor(genome) {
                this.genome = genome;

                this.fitness = calculateFitness(this.genome);
            }

            mutate() {
                // Genom üzerinde mutasyon uygula
                // Bu kısım daha karmaşık bir şekilde implemente edilebilir
                const mutationRate = 0.1; // Mutasyon oranı, genomdaki her genin bu oranda mutasyona uğrama olasılığı

                for (let i = 0; i < this.genome.length; i++) {
                    if (Math.random() < mutationRate) {
                        // Mutasyon olasılığı gerçekleşirse, genin değerini küçük bir rastgele değerle değiştir
                        this.genome[i] += (Math.random() - 0.5) * 0.1; // Örnek: [-0.05, 0.05] arasında rastgele değer ekler
                    }
                }
            }
        }

        function generateRandomGenome(length, distributionType) {
            if (distributionType === "uniform") {
                // Eşit olasılıklı (uniform) dağılım
                return Array.from({ length }, () => Math.random());
            } else if (distributionType === "normal") {
                // Normal dağılım
                // Bu kısım daha karmaşık bir şekilde implemente edilebilir
                return Array.from({ length }, () => Math.random() * 10); // 0 ile 10 arasında normal dağılıma sahip sayılar

            } else if (distributionType === "artan") {
                // Artan dağılım
                // Bu kısım daha karmaşık bir şekilde implemente edilebilir
                return Array.from({ length }, (_, index) => index + 1);

            } else if (distributionType === "fibonacci") {
                // Fibonacci algoritması
                const genome = [0, 1];
                for (let i = 2; i < length; i++) {
                    genome.push(genome[i - 1] + genome[i - 2]);
                }
                return genome;
            }
            else {
                // Varsayılan olarak eşit olasılıklı dağılımı kullan
                return Array.from({ length }, () => Math.random());
            }
        }


        function calculateFitness(genome) {
            const fitnessFunction = document.getElementById("fitnessFunction").value;

            switch (fitnessFunction) {
                case "random":
                    return Math.random();
                case "absoluteDifference":
                    return calculateAbsoluteDifferenceFitness(genome);
                // İleriye dönük başka fitness fonksiyonları da ekleyebilirsiniz
                default:
                    return 0;
            }

            function calculateAbsoluteDifferenceFitness(genome) {
                const totalDifference = genome.reduce((total, gene, index, array) => {
                    if (index < array.length - 1) {
                        const difference = Math.abs(gene - array[index + 1]);
                        return total + difference;
                    }
                    return total;
                }, 0);

                // Genomun toplam farkı ne kadar küçükse, fitness o kadar yüksek olacaktır
                const fitness = 1 / (1 + totalDifference);

                return fitness;
            }
        }

        function evolvePopulation(population) {
            // Popülasyonu evrimleştir
            // Bu kısım da daha karmaşık bir şekilde implemente edilebilir            
            const newPopulation = [];
            for (let i = 0; i < population.length; i += 2) {
                const parent1 = selectParent(population);
                const parent2 = selectParent(population);
                const child1 = crossover(parent1, parent2);
                const child2 = crossover(parent2, parent1);
                child1.mutate();
                child2.mutate();
                newPopulation.push(child1, child2);
            }
            return newPopulation;
        }

        function selectParent(population) {
            // Ebeveyn seçimi
            // Bu kısım da daha karmaşık bir şekilde implemente edilebilir
            const randomIndex = Math.floor(Math.random() * population.length);
            return population[randomIndex];
        }

        function crossover(parent1, parent2) {
            // Çaprazlama (crossover) işlemi
            // Bu kısım daha karmaşık bir şekilde implemente edilebilir

            const crossoverPoint = Math.floor(Math.random() * parent1.genome.length);
            const childGenome = [...parent1.genome.slice(0, crossoverPoint), ...parent2.genome.slice(crossoverPoint)];
            return new Individual(childGenome);
        }

        function startSimulation() {
            const genomeLength = parseInt(document.getElementById("genomeLength").value);
            const initialPopulationSize = parseInt(document.getElementById("initialPopulationSize").value);
            const targetGeneration = parseInt(document.getElementById("targetGeneration").value);
            const distributionType = document.getElementById("distributionType").value;


            if (isNaN(genomeLength) || isNaN(initialPopulationSize) || genomeLength <= 0 || initialPopulationSize <= 0) {
                alert("Lütfen geçerli bir genom uzunluğu ve başlangıç popülasyon boyutu girin.");
                return;
            }

            let population = Array.from(
                { length: initialPopulationSize },
                () => new Individual(generateRandomGenome(genomeLength, distributionType))
            );

            const resultElement = document.getElementById("simulationResult");
            resultElement.innerHTML = ""; // Tabloyu temizleme


            for (let generation = 1; generation <= targetGeneration; generation++) {
                population = evolvePopulation(population); // Burada population'ı geçirdiğinizden emin olun
                const bestIndividual = findBestIndividual(population);
                displayResults(generation, bestIndividual);

            }
        }

        function findBestIndividual(population) {
            // En iyi bireyi bul
            return population.reduce((best, current) => (current.fitness > best.fitness ? current : best), population[0]);
        }

        function displayResults(generation, bestIndividual) {
            const resultElement = document.getElementById("simulationResult");
            const row = resultElement.insertRow(-1);
            const cell1 = row.insertCell(0);
            const cell2 = row.insertCell(1);
            const cell3 = row.insertCell(2);

            cell1.textContent = generation;
            cell2.textContent = bestIndividual.genome.join(", ");
            cell3.textContent = bestIndividual.fitness;

            updateChart(generation, bestIndividual.fitness)
        }
    </script>
</body>

</html>